# https://github.com/minio/minio/blob/master/helm/minio/README.md
minio:
  mode: standalone

  # TODO: docker image is not provided anymore, uses an old version
  #image:
  #  repository: quay.io/minio/minio
  #  tag: RELEASE.2024-12-18T13-15-44Z
  #mcImage:
  #  repository: quay.io/minio/mc
  #  tag: RELEASE.2024-11-21T17-21-54Z

  persistence:
    enabled: true
    existingClaim: "minio-data-pvc"

  replicas: 1

  # API
  #ingress:
  #  enabled: true
  #  hosts:
  #    - <overwrite>

  # Web UI
  consoleIngress:
    enabled: true
    hosts:
      - <overwrite>

  existingSecret: "minio-root-credentials"

  resources:
    requests:
      memory: 512Mi  # default requests 16Gi of memory...

  #networkpolicy:  # using my own generic chart for network policies
  #  enabled: true
  #  flavor: cilium
  #  allowExternal: false

  ## List of buckets to be created after minio install
  buckets:
    - name: cloudnative-pg-backup
      policy: none
      purge: false
      versioning: false
      objectlocking: false

  users:
    - accessKey: "cloudnative-pg"
      existingSecret: "cloudnative-pg-minio-user-credentials"
      existingSecretKey: secretKey
      policy: readwrite  # TODO: not limited to a specific bucket...

longhornstorage:
  volumes:
    minio-data:
      enabled: true
      size: "2Gi"
      variant: "retain"
      pvName: "<overwrite>"
      name: "minio-data-pvc"

networkpolicy:
  preset:
    ingress:
      fromNamespace: "cloudnative-pg"

externalsecrets:
  secrets:
    minio-root-credentials:
      commonRemoteKey: "<overwrite>" 
      fields:
        rootUser:
          storeRefName: bitwarden-login
          remoteProperty: username
        rootPassword:
          storeRefName: bitwarden-login
          remoteProperty: password
    cloudnative-pg-minio-user-credentials:
      commonRemoteKey: "<overwrite>" 
      fields:
        #accessKey:  # <-- can not be used from the secret apparently
        #  storeRefName: bitwarden-login
        #  remoteProperty: username
        secretKey:
          storeRefName: bitwarden-login
          remoteProperty: password
