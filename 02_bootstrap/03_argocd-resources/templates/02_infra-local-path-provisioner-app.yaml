apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: local-path-provisioner
spec:
  destination:
    namespace: infra-local-path-provisioner
    server: {{ .Values.server }}
  # TODO: its own projects that allows just the github repository source?
  project: infra
  sources:
    - repoURL: {{ .Values.repoUrl }}
      targetRevision: {{ .Values.targetRevision }}
      ref: values
    - helm:
        version: v3
        valueFiles:
          - $values/03_infra/local-path-provisioner.custom/values.yaml
      path: deploy/chart/local-path-provisioner
      repoURL: https://github.com/rancher/local-path-provisioner
      targetRevision: v0.0.31
  syncPolicy:
    automated:
      selfHeal: true
      prune: true
    syncOptions:
      - CreateNamespace=true

